<?/*xml version="1.0" encoding="UTF-8" */?>
<!-- This is a WordPress eXtended RSS file generated by WordPress as an export of your site. -->
<!-- It contains information about your site's posts, pages, comments, categories, and other content. -->
<!-- You may use this file to transfer that content from one site to another. -->
<!-- This file is not intended to serve as a complete backup of your site. -->

<!-- To import this information into a WordPress site follow these steps: -->
<!-- 1. Log in to that site as an administrator. -->
<!-- 2. Go to Tools: Import in the WordPress admin panel. -->
<!-- 3. Install the "WordPress" importer from the list. -->
<!-- 4. Activate & Run Importer. -->
<!-- 5. Upload this file using the form provided on that page. -->
<!-- 6. You will first be asked to map the authors in this export file to users -->
<!--    on the site. For each author, you may choose to map to an -->
<!--    existing user on the site or to create a new user. -->
<!-- 7. WordPress will then import each of the posts, pages, comments, categories, etc. -->
<!--    contained in this file into your site. -->

<!-- generator="WordPress/4.0.1" created="2014-12-09 22:37" -->
<rss version="2.0"
    xmlns:excerpt="http://wordpress.org/export/1.2/excerpt/"
    xmlns:content="http://purl.org/rss/1.0/modules/content/"
    xmlns:wfw="http://wellformedweb.org/CommentAPI/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:wp="http://wordpress.org/export/1.2/"
>

<?php
    function rename_drawing($drawing_name, $names) {
        if (in_array($drawing_name, $names)) {
            return true;
        }
        return false;
    }
?>

<channel>
    <title>fan art</title>
    <link>http://localhost/fanart3</link>
    <description>Un site utilisant WordPress</description>
    <pubDate>Tue, 09 Dec 2014 22:37:44 +0000</pubDate>
    <language>fr-FR</language>
    <wp:wxr_version>1.2</wp:wxr_version>
    <wp:base_site_url>http://localhost/fanart3</wp:base_site_url>
    <wp:base_blog_url>http://localhost/fanart3</wp:base_blog_url>

    <?php $u = array(); ?>
    <?php foreach($this->users as $user): ?>
    <?/*<wp:author>
        <wp:author_id><?php echo $user->id ?></wp:author_id>
        <wp:author_login><?php echo $user->login ?></wp:author_login>
        <wp:author_email><?php echo $user->email ?></wp:author_email>
        <wp:author_display_name><![CDATA[<?php echo $user->login ?>]]></wp:author_display_name>
        <wp:author_first_name><![CDATA[<?php echo $user->firstname ?>]]></wp:author_first_name>
        <wp:author_last_name><![CDATA[<?php echo $user->lastname ?>]]></wp:author_last_name>
    </wp:author>*/?>
    <?php $u[$user->id] = $user->login; ?>
    <?php endforeach; ?>
<?/*
    <wp:category>
        <wp:term_id>10000</wp:term_id>
        <wp:category_nicename>mangas</wp:category_nicename>
        <wp:category_parent></wp:category_parent>
        <wp:cat_name><![CDATA[Mangas]]></wp:cat_name>
    </wp:category>
    <wp:category>
        <wp:term_id>10001</wp:term_id>
        <wp:category_nicename>jeux-videos</wp:category_nicename>
        <wp:category_parent></wp:category_parent>
        <wp:cat_name><![CDATA[Jeux vidéos]]></wp:cat_name>
    </wp:category>
    <wp:category>
        <wp:term_id>10002</wp:term_id>
        <wp:category_nicename>cinema-tv</wp:category_nicename>
        <wp:category_parent></wp:category_parent>
        <wp:cat_name><![CDATA[Cinéma/TV]]></wp:cat_name>
    </wp:category>
    <wp:category>
        <wp:term_id>10003</wp:term_id>
        <wp:category_nicename>creation</wp:category_nicename>
        <wp:category_parent></wp:category_parent>
        <wp:cat_name><![CDATA[Création]]></wp:cat_name>
    </wp:category>
    <wp:category>
        <wp:term_id>10004</wp:term_id>
        <wp:category_nicename>comics</wp:category_nicename>
        <wp:category_parent></wp:category_parent>
        <wp:cat_name><![CDATA[Comics]]></wp:cat_name>
    </wp:category>
    <wp:category>
        <wp:term_id>10005</wp:term_id>
        <wp:category_nicename>bande-dessinees</wp:category_nicename>
        <wp:category_parent></wp:category_parent>
        <wp:cat_name><![CDATA[Bande dessinées]]></wp:cat_name>
    </wp:category>
    <wp:category>
        <wp:term_id>10006</wp:term_id>
        <wp:category_nicename>autres</wp:category_nicename>
        <wp:category_parent></wp:category_parent>
        <wp:cat_name><![CDATA[Autres]]></wp:cat_name>
    </wp:category>
*/?>
    <?php $sc = array(); ?>
    <?php $scslug = array(); ?>
    <?php foreach($this->subcategories as $category): ?>
    <?php
        switch($category->category_id) {
            case(1): $parent = 'Mangas';
            break;
            case(2): $parent = 'Jeux vidéos';
            break;
            case(3): $parent = 'Cinéma/TV';
            break;
            case(5): $parent = 'Création';
            break;
            case(6): $parent = 'Comics';
            break;
            case(7): $parent = 'Bande dessinées';
            break;
            default: $parent = 'Autres';
            break;
        }
    ?>
<?/*
    <wp:category>
        <wp:term_id><?php echo $category->id ?></wp:term_id>
        <wp:category_nicename><?php echo $category->name_url ?></wp:category_nicename>
        <wp:category_parent><![CDATA[<?php echo $parent; ?>]]></wp:category_parent>
        <wp:cat_name><![CDATA[<?php echo $category->name ?>]]></wp:cat_name>
    </wp:category> */?>
    <?php $sc[$category->id] = $category->name; ?>
    <?php $scslug[$category->id] = $category->name_url; ?>
    <?php endforeach;?>

    <generator>http://wordpress.org/?v=4.0.1</generator>


    <?php $id = 1; ?>
    <?php $names = array(); ?>
    <?php foreach($this->draws as $draws): ?>
    <?php $date = new DateTime($draws->drawing_create); ?>
    <?php
        $ii = 2;
        $draws->drawing_name = ucfirst(strtolower($draws->drawing_name));
        while(rename_drawing($draws->drawing_name, $names)) {
            $draws->drawing_name .= ' '.$ii;
            $ii++;
        }
    ?>
    <item>
        <title><?php echo $draws->drawing_name; ?></title>
        <link>http://localhost/fanart3/?p=<?php echo $id; ?></link>
        <pubDate><?php echo $date->format('D, d M Y H:i:s O'); ?></pubDate>
        <dc:creator><![CDATA[<?php echo $u[$draws->drawing_user] ?>]]></dc:creator>
        <guid isPermaLink="false">http://localhost/fanart3/?p=<?php echo $id; ?></guid>
        <description></description>
        <content:encoded><![CDATA[<?php echo $draws->comment; ?>]]></content:encoded>
        <excerpt:encoded><![CDATA[]]></excerpt:encoded>
        <wp:post_id><?php echo $id; ?></wp:post_id>
        <wp:post_date><?php echo $draws->drawing_create; ?></wp:post_date>
        <wp:post_date_gmt><?php echo $draws->drawing_create; ?></wp:post_date_gmt>
        <wp:comment_status>open</wp:comment_status>
        <wp:ping_status>open</wp:ping_status>
        <wp:post_name><?php echo $this->filter->filter($draws->drawing_name); ?></wp:post_name>
        <wp:status>publish</wp:status>
        <wp:post_parent>0</wp:post_parent>
        <wp:menu_order>0</wp:menu_order>
        <wp:post_type>post</wp:post_type>
        <wp:post_password></wp:post_password>
        <wp:is_sticky>0</wp:is_sticky>
        <category domain="category" nicename="<?php echo $scslug[$draws->drawing_cat] ?>"><![CDATA[<?php echo $sc[$draws->drawing_cat] ?>]]></category>


        <category domain="post_tag" nicename="<?php echo $u[$draws->drawing_user] ?>"><![CDATA[<?php echo $u[$draws->drawing_user] ?>]]></category>


        <wp:postmeta>
            <wp:meta_key>_thumbnail_id</wp:meta_key>
            <wp:meta_value><![CDATA[<?php echo $id + 1; ?>]]></wp:meta_value>
        </wp:postmeta>
        <?php $comments = $draws->getDrawing()->findComments(); ?>
        <?php foreach($comments as $comment) : ?>
        <wp:comment>
            <wp:comment_id><?php echo $comment->id ?></wp:comment_id>
            <wp:comment_author><![CDATA[<?php echo $comment->login ?>]]></wp:comment_author>
            <wp:comment_author_email></wp:comment_author_email>
            <wp:comment_author_url></wp:comment_author_url>
            <wp:comment_author_IP></wp:comment_author_IP>
            <wp:comment_date><?php echo $comment->created_at; ?></wp:comment_date>
            <wp:comment_date_gmt><?php echo $comment->created_at; ?></wp:comment_date_gmt>
            <wp:comment_content><![CDATA[<?php echo $comment->value ?>]]></wp:comment_content>
            <wp:comment_approved>1</wp:comment_approved>
            <wp:comment_type></wp:comment_type>
            <wp:comment_parent>0</wp:comment_parent>
            <wp:comment_user_id>0</wp:comment_user_id>
        </wp:comment>
        <?php endforeach; ?>
    </item>
    <?php $names[] = $draws->drawing_name; ?>
    <?php $id++; ?>
    <item>
        <?/*<title>drawing-<?php echo $this->filter->filter($draws->drawing_name); ?>-<?php echo $u[$draws->drawing_user] ?>-<?php echo $date->format('Y-M'); ?></title>*/?>
        <title><?php echo $this->filter->filter($draws->drawing_name); ?>-<?php echo $scslug[$draws->drawing_cat] ?>;</title>
        <link>http://localhost/fanart3/?attachment_id=<?php echo $id; ?></link>
        <pubDate><?php echo $date->format('D, d M Y H:i:s O'); ?></pubDate>
        <dc:creator><![CDATA[<?php echo $u[$draws->drawing_user] ?>]]></dc:creator>
        <guid isPermaLink="false">http://localhost<?= $this->fileUrl($draws, null, null, 'get') ?>.jpg</guid>
        <description></description>
        <content:encoded><![CDATA[]]></content:encoded>
        <excerpt:encoded><![CDATA[]]></excerpt:encoded>
        <wp:post_id><?php echo $id; ?></wp:post_id>
        <wp:post_date><?php echo $draws->drawing_create; ?></wp:post_date>
        <wp:post_date_gmt><?php echo $draws->drawing_create; ?></wp:post_date_gmt>
        <wp:comment_status>open</wp:comment_status>
        <wp:ping_status>open</wp:ping_status>
        <wp:post_name>drawing-<?php echo $this->filter->filter($draws->drawing_name); ?>-<?php echo $u[$draws->drawing_user] ?>-<?php echo $date->format('Y-M'); ?></wp:post_name>
        <wp:status>inherit</wp:status>
        <wp:post_parent>0</wp:post_parent>
        <wp:menu_order>0</wp:menu_order>
        <wp:post_type>attachment</wp:post_type>
        <wp:post_password></wp:post_password>
        <wp:is_sticky>0</wp:is_sticky>
        <wp:attachment_url>http://localhost<?= $this->fileUrl($draws, null, null, 'get') ?>.jpg</wp:attachment_url>
        <wp:postmeta>
            <wp:meta_key>_wp_attached_file</wp:meta_key>
            <wp:meta_value><![CDATA[<?php echo $date->format('Y'); ?>/<?php echo $date->format('m'); ?>/<?php echo $draws->filename; ?>]]></wp:meta_value>
        </wp:postmeta>
    </item>
    <?php $id++; ?>
    <?php endforeach; ?>
</channel>
</rss>
